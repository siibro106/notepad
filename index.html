<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Notepad</title>
    <style>
        :root {
            --bg-color: #ffffff;
            --text-color: #000000;
            --editor-bg: #ffffff;
            --editor-text: #000000;
            --border-color: #cccccc;
            --button-bg: #f0f0f0;
            --button-hover: #e0e0e0;
            --status-online: #4caf50;
            --status-offline: #f44336;
            --preview-bg: #f8f8f8;
        }

        .dark-mode {
            --bg-color: #1e1e1e;
            --text-color: #ffffff;
            --editor-bg: #2d2d2d;
            --editor-text: #ffffff;
            --border-color: #555555;
            --button-bg: #3c3c3c;
            --button-hover: #4c4c4c;
            --preview-bg: #252525;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .toolbar {
            display: flex;
            gap: 10px;
            padding: 10px 20px;
            border-bottom: 1px solid var(--border-color);
            flex-wrap: wrap;
        }

        button {
            background-color: var(--button-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        button:hover {
            background-color: var(--button-hover);
        }

        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #2196F3;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .editor-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 10px;
        }

        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .filename-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #fileName {
            background: transparent;
            border: 1px solid transparent;
            color: var(--text-color);
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 1rem;
        }

        #fileName:focus {
            border-color: var(--border-color);
            outline: none;
        }

        .edit-icon {
            cursor: pointer;
            font-size: 0.9rem;
            opacity: 0.7;
        }

        .edit-icon:hover {
            opacity: 1;
        }

        textarea {
            flex: 1;
            background-color: var(--editor-bg);
            color: var(--editor-text);
            border: 1px solid var(--border-color);
            padding: 15px;
            font-size: 16px;
            resize: none;
            outline: none;
            border-radius: 4px;
            line-height: 1.5;
        }

        .preview-mode {
            flex: 1;
            background-color: var(--preview-bg);
            border: 1px solid var(--border-color);
            padding: 15px;
            overflow: auto;
            white-space: pre-wrap;
            line-height: 1.5;
            border-radius: 4px;
        }

        .preview-mode a {
            color: #2196F3;
            text-decoration: underline;
            cursor: pointer;
        }

        .preview-mode a:hover {
            text-decoration: none;
        }

        footer {
            display: flex;
            justify-content: space-between;
            padding: 8px 20px;
            border-top: 1px solid var(--border-color);
            font-size: 0.9rem;
        }

        .status {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .online {
            background-color: var(--status-online);
        }

        .offline {
            background-color: var(--status-offline);
        }

        .hidden {
            display: none;
        }

        .preview-active {
            background-color: #4CAF50;
            color: white;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">Web Notepad</div>
        <div class="theme-toggle">
            <span>Light</span>
            <label class="switch">
                <input type="checkbox" id="themeToggle">
                <span class="slider"></span>
            </label>
            <span>Dark</span>
        </div>
    </header>

    <div class="toolbar">
        <button id="newBtn">New</button>
        <button id="openBtn">Open</button>
        <button id="saveBtn">Save</button>
        <button id="saveAsBtn">Save As</button>
        <button id="previewToggle">Preview Mode</button>
    </div>

    <div class="editor-container">
        <div class="editor-header">
            <h3>Editor</h3>
            <div class="filename-container">
                <input type="text" id="fileName" value="Untitled.txt">
                <span class="edit-icon" title="Edit filename">✏️</span>
            </div>
        </div>
        <textarea id="textEditor" placeholder="Start typing..."></textarea>
    </div>

    <footer>
        <div class="status">
            <div class="status-indicator" id="statusIndicator"></div>
            <span id="statusText">Checking connection...</span>
        </div>
        <div class="char-count">Characters: <span id="charCount">0</span></div>
    </footer>

    <input type="file" id="fileInput" class="hidden" accept=".txt,.html,.js,.css,.md,.doc,.docx">
    <a id="downloadLink" class="hidden"></a>

    <script>
        // DOM Elements
        const themeToggle = document.getElementById('themeToggle');
        const textEditor = document.getElementById('textEditor');
        const previewToggle = document.getElementById('previewToggle');
        const newBtn = document.getElementById('newBtn');
        const openBtn = document.getElementById('openBtn');
        const saveBtn = document.getElementById('saveBtn');
        const saveAsBtn = document.getElementById('saveAsBtn');
        const fileInput = document.getElementById('fileInput');
        const downloadLink = document.getElementById('downloadLink');
        const fileName = document.getElementById('fileName');
        const statusIndicator = document.getElementById('statusIndicator');
        const statusText = document.getElementById('statusText');
        const charCount = document.getElementById('charCount');

        // State variables
        let currentFileHandle = null;
        let isDarkMode = false;
        let isPreviewMode = false;
        let originalEditorContent = '';

        // Initialize the application
        function init() {
            // Set up event listeners
            themeToggle.addEventListener('change', toggleTheme);
            textEditor.addEventListener('input', updateCharCount);
            previewToggle.addEventListener('click', togglePreviewMode);
            newBtn.addEventListener('click', newFile);
            openBtn.addEventListener('click', openFile);
            saveBtn.addEventListener('click', saveFile);
            saveAsBtn.addEventListener('click', saveFileAs);
            fileName.addEventListener('change', updateFileName);
            
            // Check online status
            updateOnlineStatus();
            window.addEventListener('online', updateOnlineStatus);
            window.addEventListener('offline', updateOnlineStatus);
            
            // Initialize character count
            updateCharCount();
        }

        // Theme toggle functionality
        function toggleTheme() {
            isDarkMode = themeToggle.checked;
            if (isDarkMode) {
                document.body.classList.add('dark-mode');
            } else {
                document.body.classList.remove('dark-mode');
            }
            
            // Save theme preference to localStorage
            localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
        }

        // Load saved theme preference
        function loadThemePreference() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                themeToggle.checked = true;
                document.body.classList.add('dark-mode');
                isDarkMode = true;
            }
        }

        // Update character count
        function updateCharCount() {
            charCount.textContent = textEditor.value.length;
        }

        // Toggle preview mode
        function togglePreviewMode() {
            isPreviewMode = !isPreviewMode;
            
            if (isPreviewMode) {
                // Switch to preview mode
                originalEditorContent = textEditor.value;
                const previewContent = formatPreviewContent(originalEditorContent);
                
                // Replace textarea with preview div
                const previewDiv = document.createElement('div');
                previewDiv.className = 'preview-mode';
                previewDiv.innerHTML = previewContent;
                
                textEditor.parentNode.replaceChild(previewDiv, textEditor);
                previewToggle.textContent = 'Edit Mode';
                previewToggle.classList.add('preview-active');
                
                // Make links clickable
                makeLinksClickable(previewDiv);
            } else {
                // Switch back to edit mode
                const previewDiv = document.querySelector('.preview-mode');
                if (previewDiv) {
                    textEditor.value = originalEditorContent;
                    previewDiv.parentNode.replaceChild(textEditor, previewDiv);
                }
                previewToggle.textContent = 'Preview Mode';
                previewToggle.classList.remove('preview-active');
            }
        }

        // Format content for preview (convert URLs and emails to links)
        function formatPreviewContent(content) {
            // URL regex pattern - matches http, https, ftp, and www URLs
            const urlRegex = /(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])|(\bwww\.[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi;
            
            // Email regex pattern
            const emailRegex = /(\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b)/gi;
            
            let formattedContent = content;
            
            // Replace URLs with anchor tags
            formattedContent = formattedContent.replace(urlRegex, function(match) {
                let url = match;
                if (!url.startsWith('http') && !url.startsWith('ftp')) {
                    url = 'http://' + url;
                }
                return '<a href="' + url + '" target="_blank">' + match + '</a>';
            });
            
            // Replace emails with mailto links
            formattedContent = formattedContent.replace(emailRegex, '<a href="mailto:$1">$1</a>');
            
            // Handle line breaks
            formattedContent = formattedContent.replace(/\n/g, '<br>');
            
            return formattedContent;
        }

        // Make links in preview clickable
        function makeLinksClickable(previewDiv) {
            const links = previewDiv.querySelectorAll('a');
            links.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const url = this.getAttribute('href');
                    
                    // Open URL in a new tab
                    if (url.startsWith('mailto:')) {
                        window.location.href = url;
                    } else {
                        window.open(url, '_blank');
                    }
                });
            });
        }

        // Update filename
        function updateFileName() {
            // Ensure the filename has an extension
            let name = fileName.value;
            if (!name.includes('.')) {
                name += '.txt';
                fileName.value = name;
            }
        }

        // Create a new file
        function newFile() {
            if (textEditor.value && !confirm('Are you sure you want to create a new file? Unsaved changes will be lost.')) {
                return;
            }
            
            textEditor.value = '';
            fileName.value = 'Untitled.txt';
            currentFileHandle = null;
            updateCharCount();
            
            // If in preview mode, switch back to edit mode
            if (isPreviewMode) {
                togglePreviewMode();
            }
        }

        // Open a file
        function openFile() {
            fileInput.click();
        }

        // Handle file selection
        fileInput.addEventListener('change', async (event) => {
            const file = event.target.files[0];
            if (!file) return;
            
            try {
                const text = await file.text();
                textEditor.value = text;
                fileName.value = file.name;
                currentFileHandle = null; // Reset file handle since we opened via traditional method
                updateCharCount();
                
                // If in preview mode, switch back to edit mode
                if (isPreviewMode) {
                    togglePreviewMode();
                }
            } catch (error) {
                alert('Error reading file: ' + error.message);
            }
            
            // Reset the file input
            fileInput.value = '';
        });

        // Save file (using File System Access API if available)
        async function saveFile() {
            // If we have a file handle, write to it
            if (currentFileHandle) {
                try {
                    const writable = await currentFileHandle.createWritable();
                    await writable.write(textEditor.value);
                    await writable.close();
                    showNotification('File saved successfully!');
                } catch (error) {
                    alert('Error saving file: ' + error.message);
                }
            } else {
                // Otherwise, do Save As
                saveFileAs();
            }
        }

        // Save file as (using File System Access API if available)
        async function saveFileAs() {
            try {
                // Check if the File System Access API is available
                if ('showSaveFilePicker' in window) {
                    const options = {
                        suggestedName: fileName.value,
                        types: [
                            {
                                description: 'Text Files',
                                accept: {
                                    'text/plain': ['.txt']
                                }
                            },
                            {
                                description: 'All Files',
                                accept: {
                                    '*/*': ['.*']
                                }
                            }
                        ]
                    };
                    
                    const fileHandle = await window.showSaveFilePicker(options);
                    const writable = await fileHandle.createWritable();
                    await writable.write(textEditor.value);
                    await writable.close();
                    
                    currentFileHandle = fileHandle;
                    fileName.value = fileHandle.name;
                    showNotification('File saved successfully!');
                } else {
                    // Fallback for browsers that don't support File System Access API
                    const blob = new Blob([textEditor.value], { type: 'text/plain' });
                    const url = URL.createObjectURL(blob);
                    downloadLink.href = url;
                    downloadLink.download = fileName.value;
                    downloadLink.click();
                    URL.revokeObjectURL(url);
                    showNotification('File downloaded successfully!');
                }
            } catch (error) {
                if (error.name !== 'AbortError') {
                    alert('Error saving file: ' + error.message);
                }
            }
        }

        // Update online/offline status
        function updateOnlineStatus() {
            if (navigator.onLine) {
                statusIndicator.className = 'status-indicator online';
                statusText.textContent = 'Online';
            } else {
                statusIndicator.className = 'status-indicator offline';
                statusText.textContent = 'Offline';
            }
        }

        // Show notification
        function showNotification(message) {
            // Create a simple notification
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.style.position = 'fixed';
            notification.style.bottom = '20px';
            notification.style.right = '20px';
            notification.style.backgroundColor = '#4CAF50';
            notification.style.color = 'white';
            notification.style.padding = '10px 15px';
            notification.style.borderRadius = '4px';
            notification.style.zIndex = '1000';
            notification.style.boxShadow = '0 2px 5px rgba(0,0,0,0.2)';
            
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 3000);
        }

        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            loadThemePreference();
            init();
        });
    </script>
</body>
</html>